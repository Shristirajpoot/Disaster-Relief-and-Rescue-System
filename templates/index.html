<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home | AI Disaster Relief & Rescue System</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
    body{
      background:linear-gradient(135deg,#001f3f,#004d73);
      color:#fff;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* HEADER */
    header{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      background:rgba(0,0,0,0.4);
      padding:18px 50px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      backdrop-filter:blur(8px);
      z-index:1000;
    }
    header h1{font-size:26px;font-weight:700;color:#00e6ff;}
    nav a{text-decoration:none;color:#fff;margin:0 15px;transition:0.3s;font-weight:500;}
    nav a:hover,nav a.active{color:#00e6ff;border-bottom:2px solid #00e6ff;}

    /* MAIN */
    main{
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:180px 20px 40px; /* space for fixed header + alert */
    }

    h2{font-size:36px;color:#00e6ff;margin-bottom:10px;animation:glow 2s infinite alternate;}
    p{color:#d6d6d6;margin-bottom:15px;font-size:18px;}

    /* VIDEO SECTION */
    .video-section{position:relative;margin-top:25px;}
    img{
      border:3px solid #00e6ff;
      border-radius:12px;
      width:640px;
      height:360px;
      object-fit:cover;
    }
    .status-bar{margin-top:12px;font-size:16px;color:#00ffcc;font-weight:600;}

    /* GRADCAM SECTION */
    .gradcam-section{
      margin-top:40px;
      text-align:center;
    }

    footer{
      text-align:center;
      padding:18px;
      background:rgba(0,0,0,0.4);
      font-size:14px;
      color:#aaa;
    }

    @keyframes glow{
      from{text-shadow:0 0 10px #00e6ff;}
      to{text-shadow:0 0 25px #00e6ff,0 0 40px #00e6ff;}
    }

    /* CHATBOT */
    .chatbot-button{
      position:fixed;
      bottom:25px;
      right:25px;
      background:#00e6ff;
      color:#001f3f;
      border:none;
      border-radius:50%;
      width:60px;
      height:60px;
      font-size:26px;
      cursor:pointer;
      box-shadow:0 0 15px rgba(0,230,255,0.6);
      transition:transform 0.3s;
      z-index:900;
    }
    .chatbot-button:hover{transform:scale(1.1);}
    .chat-window{
      display:none;
      position:fixed;
      bottom:100px;
      right:25px;
      background:rgba(0,31,63,0.95);
      border:1px solid #00e6ff;
      border-radius:12px;
      width:320px;
      height:400px;
      box-shadow:0 0 20px rgba(0,230,255,0.4);
      flex-direction:column;
      overflow:hidden;
      z-index:900;
    }
    .chat-header{
      background:#00e6ff;
      color:#001f3f;
      padding:12px;
      font-weight:600;
      text-align:center;
    }
    .chat-messages{flex:1;padding:10px;overflow-y:auto;font-size:14px;}
    .chat-input{display:flex;border-top:1px solid #00e6ff;}
    .chat-input input{
      flex:1;padding:10px;border:none;outline:none;
      background:rgba(255,255,255,0.1);color:#fff;
    }
    .chat-input button{
      background:#00e6ff;color:#001f3f;border:none;
      padding:10px 15px;cursor:pointer;font-weight:600;
    }
    .bot-message{color:#00ffcc;margin:5px 0;}
    .user-message{color:#fff;text-align:right;margin:5px 0;}

    /* ALERT BAR */
    #emergency-alert{
      display:none;
      position:fixed;
      top:75px;
      left:50%;
      transform:translateX(-50%);
      min-width:350px;
      max-width:90%;
      background:red;
      color:white;
      text-align:center;
      padding:10px 25px;
      border-radius:8px;
      font-size:18px;
      font-weight:bold;
      z-index:950;
      box-shadow:0 2px 10px rgba(0,0,0,0.3);
      animation:blink 1s infinite alternate;
    }

    /* ‚úÖ SMS SENT Indicator */
    #sms-status{
      display:none;
      position:fixed;
      top:120px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(0,255,100,0.9);
      color:#001f3f;
      padding:8px 18px;
      border-radius:8px;
      font-weight:600;
      font-size:16px;
      z-index:940;
      box-shadow:0 0 10px rgba(0,255,100,0.6);
      animation:fade 2s ease-in-out infinite alternate;
    }

    @keyframes blink{
      0%{background-color:#b30000;}
      100%{background-color:#ff0000;}
    }
    @keyframes fade{
      0%{opacity:0.8;}
      100%{opacity:1;}
    }

    /* RESPONSIVE */
    @media (max-width:700px){
      img{width:90%;height:auto;}
      h2{font-size:28px;}
    }
  </style>
</head>

<body>
  <!-- üö® Emergency Alert -->
  <div id="emergency-alert"></div>
  <!-- ‚úÖ SMS Sent Indicator -->
  <div id="sms-status">‚úÖ SMS Alert Sent</div>

  <!-- HEADER -->
  <header>
    <h1>üåç Disaster Relief & Rescue System</h1>
    <nav>
      <a href="{{ url_for('index') }}" class="active">Home</a>
      <a href="{{ url_for('about') }}">About</a>
      <a href="{{ url_for('contact') }}">Contact</a>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <h2>AI-Powered Disaster Detection</h2>
    <p>Experience real-time detection, alerts, and Grad-CAM visualization for floods & fires.</p>

    <div class="video-section">
      <img src="{{ url_for('video_feed') }}" alt="Live AI Feed">
      <div class="status-bar">
        Status: <span id="disaster-status">Analyzing...</span>
      </div>
    </div>


    <!-- üß† Grad-CAM Visualization Section -->
    <div class="gradcam-section">
      <h3 style="color:#00e6ff;margin-bottom:10px;">üß† Grad-CAM Visualization (AI Attention Map)</h3>
      <img id="gradcam-image" src="/gradcam_feed" alt="Grad-CAM Output"
           style="border:3px solid #00e6ff;border-radius:12px;width:640px;height:360px;object-fit:cover;">
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    ¬© 2025 <b>AI Disaster Relief and Rescue System</b> | Powered by Deep Learning üî•üåä
  </footer>

  <!-- ü§ñ CHATBOT -->
  <button class="chatbot-button" id="chatbot-btn"><i class="fa-solid fa-robot"></i></button>
  <div class="chat-window" id="chat-window">
    <div class="chat-header">Ask DisasterBot ü§ñ</div>
    <div class="chat-messages" id="chat-messages">
      <div class="bot-message">Hello! Need help understanding how detection or Grad-CAM works?</div>
    </div>
    <div class="chat-input">
      <input type="text" id="user-input" placeholder="Type your message..." />
      <button id="send-btn">Send</button>
    </div>
  </div>

  <script>
    // Chatbot Logic
    const chatbotBtn=document.getElementById("chatbot-btn");
    const chatWindow=document.getElementById("chat-window");
    const messages=document.getElementById("chat-messages");
    const userInput=document.getElementById("user-input");
    const sendBtn=document.getElementById("send-btn");
    const statusText=document.getElementById("disaster-status");

    chatbotBtn.addEventListener("click",()=>{chatWindow.style.display=chatWindow.style.display==="flex"?"none":"flex";});
    sendBtn.addEventListener("click",()=>sendMessage());
    userInput.addEventListener("keypress",(e)=>{if(e.key==="Enter")sendMessage();});

    function sendMessage(){
      const text=userInput.value.trim();
      if(text==="")return;
      const userMsg=document.createElement("div");
      userMsg.className="user-message";userMsg.innerText=text;messages.appendChild(userMsg);
      const botMsg=document.createElement("div");botMsg.className="bot-message";
      if(text.toLowerCase().includes("gradcam"))
        botMsg.innerText="Grad-CAM highlights the regions the AI uses to detect disasters üî•üåä";
      else if(text.toLowerCase().includes("how"))
        botMsg.innerText="Our CNN-based AI analyzes each frame and provides visual insights in real-time!";
      else if(text.toLowerCase().includes("team"))
        botMsg.innerText="Developed by Team Debugthugs üíª for a safer, smarter Bharat.";
      else
        botMsg.innerText="Try asking: 'how it works', 'gradcam', or 'who built this'.";
      messages.appendChild(botMsg);
      messages.scrollTop=messages.scrollHeight;
      userInput.value="";
    }

    // üîÅ Auto-update disaster status
    async function fetchStatus(){
      try{
        const res=await fetch('/status');
        const data=await res.json();
        statusText.textContent=data.status || "Analyzing...";
      }catch(err){statusText.textContent="Awaiting feed...";}
    }
    setInterval(fetchStatus,3000);

    // üö® Emergency Alert + ‚úÖ SMS indicator
    async function checkEmergencyAlert(){
      try{
        const res = await fetch('/alert');
        const data = await res.json();
        const alertBar = document.getElementById('emergency-alert');
        const smsIndicator = document.getElementById('sms-status');

        if(data.alert){
          alertBar.textContent = data.alert;
          alertBar.style.display = 'block';
          smsIndicator.style.display = 'block';
          setTimeout(()=>smsIndicator.style.display='none',5000);
        } else {
          alertBar.style.display = 'none';
          smsIndicator.style.display = 'none';
        }
      }catch(err){
        console.error("Alert fetch error:", err);
      }
    }
    setInterval(checkEmergencyAlert,4000);

    // üîÅ Auto-refresh Grad-CAM output
    setInterval(() => {
      const gradcamImg = document.getElementById("gradcam-image");
      gradcamImg.src = `/gradcam_feed?${new Date().getTime()}`;
    }, 5000);
  </script>
</body>
</html>
